// CodeMirror, copyright (c) by Marijn Haverbeke and others
!function(e){"object"==typeof exports&&"object"==typeof module?e(require("../../lib/codemirror")):"function"==typeof define&&define.amd?define(["../../lib/codemirror"],e):e(CodeMirror)}(function(e){"use strict";function n(e){var n=e.search(i);return-1==n?0:n}var t={},i=/[^\s\u00a0]/,l=e.Pos;e.commands.toggleComment=function(e){e.toggleComment()},e.defineExtension("toggleComment",function(e){e||(e=t);for(var n=this,i=1/0,o=this.listSelections(),r=null,a=o.length-1;a>=0;a--){var c=o[a].from(),m=o[a].to();if(!(c.line>=i))return m.line>=i&&(m=l(i,0)),i=c.line,null==r?n.uncomment(c,m,e)?r="un":(n.lineComment(c,m,e),r="line"):"un"==r?n.uncomment(c,m,e):n.lineComment(c,m,e),"un"===r?"uncomment":"comment"}}),e.defineExtension("toggleBlockComment",function(e){e||(e=t);for(var n=this,i=1/0,o=this.listSelections(),r=null,a=o.length-1;a>=0;a--){var c=o[a].from(),m=o[a].to();if(!(c.line>=i))return m.line>=i&&(m=l(i,0)),i=c.line,null==r?n.uncomment(c,m,e)?r="un":(n.blockComment(c,m,e),r="block"):"un"==r?n.uncomment(c,m,e):n.blockComment(c,m,e),"un"===r?"uncomment":"comment"}}),e.defineExtension("lineComment",function(e,o,r){r||(r=t);var a=this,c=a.getModeAt(e),m=r.lineComment||c.lineComment;if(!m)return void((r.blockCommentStart||c.blockCommentStart)&&(r.fullLines=!0,a.blockComment(e,o,r)));var s=a.getLine(e.line);if(null!=s){var u=Math.min(0!=o.ch||o.line==e.line?o.line+1:o.line,a.lastLine()+1),d=null==r.padding?" ":r.padding,f=r.commentBlankLines||e.line==o.line;a.operation(function(){if(r.indent){for(var t=null,o=e.line;u>o;++o){var c=a.getLine(o),s=c.slice(0,n(c));(null==t||t.length>s.length)&&(t=s)}for(var o=e.line;u>o;++o){var c=a.getLine(o),g=t.length;(f||i.test(c))&&(c.slice(0,g)!=t&&(g=n(c)),a.replaceRange(t+m+d,l(o,0),l(o,g)))}}else for(var o=e.line;u>o;++o)(f||i.test(a.getLine(o)))&&a.replaceRange(m+d,l(o,0))})}}),e.defineExtension("blockComment",function(e,n,o){o||(o=t);var r=this,a=r.getModeAt(e),c=o.blockCommentStart||a.blockCommentStart,m=o.blockCommentEnd||a.blockCommentEnd,s=o.blockCommentIndent||!1,u=s&&e.line!==n.line,d=u&&r.getLine(e.line).match(/[^ ]/);if(u&&r.indentSelection("add"),d&&r.indentLine(e.line,"subtract"),!c||!m)return void((o.lineComment||a.lineComment)&&0!=o.fullLines&&r.lineComment(e,n,o));var f=null==o.padding?" ":o.padding,g=Math.min(n.line,r.lastLine());g!=e.line&&0==n.ch&&i.test(r.getLine(g))&&--g,e.line>g||r.operation(function(){if(0!=o.fullLines){var t=i.test(r.getLine(g));" "!==m&&r.replaceRange(f+m,l(g)),r.replaceRange(c+f,l(e.line,0));var s=o.blockCommentLead||a.blockCommentLead;if(null!=s)for(var u=e.line+1;g>=u;++u)(u!=g||t)&&r.replaceRange(s+f,l(u,0))}else r.replaceRange(f+m,n),r.replaceRange(c+f,e)})}),e.defineExtension("uncomment",function(e,n,o){o||(o=t);var r,a=this,c=a.getModeAt(e),m=Math.min(0!=n.ch||n.line==e.line?n.line:n.line-1,a.lastLine()),s=Math.min(e.line,m),u=o.blockCommentIndent||!1,d=u&&e.line!==n.line,f=o.lineComment||c.lineComment,g=[],h=o.blockCommentStart,C=null==o.padding?" ":o.padding,p=!1;e:if(f){for(var b=s;m>=b;++b){var k=a.getLine(b),v=u?k.indexOf(h):-1;if(v>-1&&(p=!0),-1==v&&(v=k.indexOf(f)),v>-1&&!/comment/.test(a.getTokenTypeAt(l(b,v+1)))&&(v=-1),-1==v&&(b!=m||b==s)&&i.test(k))break e;if(v>-1&&i.test(k.slice(0,v)))break e;g.push(k)}if(a.operation(function(){for(var e=s;m>=e;++e){var n=p?h:f,t=g[e-s],i=t.indexOf(n),o=i+n.length;0>i||(t.slice(o,o+C.length)==C&&(o+=C.length),r=!0,a.replaceRange("",l(e,i),l(e,o)))}}),r)return!0}var L=o.blockCommentStart||c.blockCommentStart,x=o.blockCommentEnd||c.blockCommentEnd,y=L&&" "===x;if(!L||!x)return!1;var S=o.blockCommentLead||c.blockCommentLead,M=a.getLine(s),E=m==s?M:a.getLine(m),O=M.indexOf(L),R=d?E.slice(-1):E.lastIndexOf(x);if(-1==R&&s!=m&&(E=a.getLine(--m),R=E.lastIndexOf(x)),-1==O||!y&&-1==R||!/comment/.test(a.getTokenTypeAt(l(s,O+1)))||!y&&!/comment/.test(a.getTokenTypeAt(l(m,R+1))))return!1;var T=M.lastIndexOf(L,e.ch),j=-1==T?-1:M.slice(0,e.ch).indexOf(x,T+L.length);if(-1!=T&&-1!=j&&j+x.length!=e.ch)return!1;j=E.indexOf(x,n.ch);var A=E.slice(n.ch).lastIndexOf(L,j-n.ch);return T=-1==j||-1==A?-1:n.ch+A,-1!=j&&-1!=T&&T!=n.ch?!1:(a.operation(function(){a.replaceRange("",l(m,R-(C&&E.slice(R-C.length,R)==C?C.length:0)),l(m,R+x.length));var e=O+L.length;if(C&&M.slice(e,e+C.length)==C&&(e+=C.length),a.replaceRange("",l(s,O),l(s,e)),S)for(var n=s+1;m>=n;++n){var t=a.getLine(n),o=t.indexOf(S);if(-1!=o&&!i.test(t.slice(0,o))){var r=o+S.length;C&&t.slice(r,r+C.length)==C&&(r+=C.length),a.replaceRange("",l(n,o),l(n,r))}}for(var n=s+1;m>=n;++n)d&&a.indentLine(n,"subtract")}),!0)})}),// CodeMirror, copyright (c) by Marijn Haverbeke and others
function(e){"object"==typeof exports&&"object"==typeof module?e(require("../lib/codemirror")):"function"==typeof define&&define.amd?define(["../lib/codemirror"],e):e(CodeMirror)}(function(e){"use strict";function n(e){a=e.getModeAt({line:0,ch:0}),c=a.helperType||a.name,m=TypesUtil.cmModeToType(c)}function t(e){var n=l(),t=o(),i={indent:!0,lineComment:n,blockCommentStart:t.start,blockCommentEnd:t.end};e.toggleComment(i)}function i(e){var n=e.getCursor("from"),t=e.getCursor("to"),i=n.line>t.line?!0:n.ch>t.ch,a=i?t:n,c=i?n:t,m=e.getSelection(),s=o(),u=l(),d=r(),f=s.end&&" "!==s.end,g=f?!1:!0,h={fullLines:g,lineComment:u,blockCommentStart:s.start,blockCommentEnd:s.end,blockCommentIndent:d},C=e.toggleBlockComment(h);if("comment"!==C||""!==m||d)""!==m&&e.setSelection({line:a.line,ch:0},{line:c.line,ch:e.getLine(c.line).length});else{var p=1;""===h.padding?p=0:h.padding&&(p=h.padding.length);var b=s.start.length+p;e.setCursor({line:a.line,ch:a.ch+b})}}function l(){var e=a.lineComment||null;switch(m){case"html":switch(c){case"slim":return"/";case"haml":return"-#";case"jade":return"//-"}break;case"css":switch(c){case"scss":case"sass":case"less":case"stylus":return"//"}break;case"js":switch(c){case"coffeescript":case"livescript":return"#";default:return"//"}}return e}function o(){var e=a.blockCommentStart||"/*",n=a.blockCommentEnd||"*/";switch(m){case"html":switch(c){case"slim":return{start:"/! ",end:" "};case"haml":return{start:"/ ",end:" "};case"jade":return{start:"// ",end:" "};default:return{start:"<!--",end:"-->"}}break;case"js":if("coffeescript"===c)return{start:"###",end:"###"}}return{start:e,end:n}}function r(){if("html"!==m)return!1;switch(c){case"slim":case"haml":case"jade":return!0;default:return!1}}var a,c,m,s=e.keyMap.extended_base={fallthrough:"default"},u=e.keyMap["default"]==e.keyMap.macDefault,d=u?"Cmd-":"Ctrl-",f=u?"Alt-":"Shift-";s[d+"/"]=function(e){n(e),t(e)},s[f+d+"/"]=function(e){n(e),i(e)},e.normalizeKeyMap(s)}),Hub.pub("cm-update-keybindings",{});